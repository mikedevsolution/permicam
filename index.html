<!DOCTYPE html>
<html lang="fr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Permicam - Vérification</title>

    <link href="https://www.cartegrisecameroun.com/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://www.cartegrisecameroun.com/css/style.css" rel="stylesheet">
    <link href="https://www.cartegrisecameroun.com/css/all.css" rel="stylesheet">
    <link href="https://www.cartegrisecameroun.com/css/flaticon.css" rel="stylesheet">
    
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.cartegrisecameroun.com/favicon/favicon.ico">

    <style>
        /* CSS CORRECTIF pour garantir le rendu à 100% */
        body { 
            background-color: #f0f0fa; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Police standard si celle du site ne charge pas */
        }
        
        /* Correction du logo pour qu'il ne soit pas déformé */
        .nav-background img {
            height: auto;
            max-height: 80px; /* Ajuste ceci selon la taille réelle sur le site officiel */
            width: 100%;
            object-fit: contain; /* Important : garde les proportions de l'image */
            display: block;
        }

        .ms-content-wrapper { max-width: 900px; margin: 30px auto; }
        
        /* Styles des statuts */
        #status-message { padding: 20px; text-align: center; font-weight: bold; font-size: 1.1em; }
        .status-loading { color: #007bff; }
        .status-error { color: #dc3545; }

        /* Correction des bordures de table pour correspondre à Bootstrap pur */
        .table-bordered th, .table-bordered td {
            border: 1px solid #dee2e6;
            vertical-align: middle;
        }
    </style>
</head>

<body class="ms-body">
    <main class="body-content">
        <nav class="nav-background" style="background: white; padding: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <div class="container">
                <img src="Driver_brand_new_logo.jpg" alt="Logo Permicam">
            </div>
        </nav>

        <div class="ms-content-wrapper">
            <div class="row" style="justify-content:center;">
                <div class="col-md-10">
                    <div class="ms-panel">
                        <div class="ms-panel-header">
                            <div class="ms-header-text mb-0 pb-0" style="text-align: center;">
                                <h6 style="text-transform: uppercase; letter-spacing: 0.5px;">Bienvenue sur le portail d'enrolement à la demande de permis de conduire et badge</h6>
                            </div>
                        </div>
                        <div class="ms-panel-body pb-2" id="main-content">
                            <div class="ms-panel" style="box-shadow: none; border: 1px solid #eee;">
                                <div class="ms-panel-header">
                                    <div class="d-flex justify-content-between">
                                        <div class="ms-header-text">
                                            <h6 style="font-weight:bold; color: #004a99;">DEMANDE DE PERMIS DE CONDUIRE</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="ms-panel-body p-0">
                                    
                                    <div id="status-message">
                                        <div class="spinner-border text-primary" role="status" style="width: 1.5rem; height: 1.5rem;">
                                            <span class="sr-only">Chargement...</span>
                                        </div>
                                        <br>
                                        <span class="status-loading">Vérification en cours...</span>
                                    </div>
                                    
                                    <div class="table-responsive" id="permis-data" style="display:none;">
                                        <table class="table table-bordered mb-0">
                                            <caption style="caption-side: top; margin-left: 10px; font-weight: bold; color: #333; padding-bottom: 10px;">Récapitulatif de la demande</caption>
                                            
                                            <tbody>
                                                <tr>
                                                    <td style="font-weight:bold; background-color: #f8f9fa; width: 40%;">Etat de la demande</td>
                                                    <td style="width:60%">
                                                        <span id="statut-demande" style="font-weight: bold; color: red;"></span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="col" colspan="2" style="background-color: #e9ecef; text-align: center;">IDENTITÉ DU DÉTENTEUR</th>
                                                </tr>
                                            </tbody>
                                            <tbody>
                                                <tr>
                                                    <td style="vertical-align: middle;">Photo</td>
                                                    <td>
                                                        <div style="width: 120px; height: 140px; border: 1px solid #ddd; padding: 2px; background: white;">
                                                            <img id="photo-permis" src="" 
                                                                 onerror="this.src='https://via.placeholder.com/120x150?text=No+Img'" 
                                                                 style="width:100%; height:100%; object-fit: cover;">
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Nom</td>
                                                    <td><span id="nom" style="font-weight: bold"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Prénoms</td>
                                                    <td><span id="prenoms" style="font-weight: bold"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Lieu de naissance</td>
                                                    <td><span id="lieu-naissance" style="font-weight: bold"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Date de naissance</td>
                                                    <td><span id="date-naissance" style="font-weight: bold"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Genre</td>
                                                    <td><span id="genre" style="font-weight: bold"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Nationalité</td>
                                                    <td><span id="nationalite" style="font-weight: bold"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Numéro de permis</td>
                                                    <td><span id="num-permis" style="font-weight: bold; color: #0056b3;"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Numéro de capacité</td>
                                                    <td><span id="num-capacite" style="font-weight: bold;"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Catégories du permis</td>
                                                    <td><span id="categories" style="font-weight: bold;"></span></td>
                                                </tr>
                                                <tr>
                                                    <td>Date de création</td>
                                                    <td><span id="date-creation" style="font-weight: bold;"></span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer_position" id="pied-de-page" style="text-align: center; margin-top: 30px; font-size: 0.9em; color: #666;">
            <p>Copyright © 2023 - All rights reserved - MINT - Cameroon</p>
        </div>
    </main>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            
            // --- CONFIGURATION ---
            const apiUrl = "https://www.cartegrisecameroun.com/public/api/getPermisInfo.php";
            const currentYear = new Date().getFullYear();
            
            // Mise à jour automatique de l'année
            const footerP = document.querySelector("#pied-de-page p");
            if(footerP) footerP.innerHTML = `Copyright © ${currentYear} - All rights reserved - MINT - Cameroon`;

            const statusMessageEl = document.getElementById("status-message");
            const permisDataEl = document.getElementById("permis-data");
            
            const params = new URLSearchParams(window.location.search);
            const permisId = params.get('id');

            if (!permisId) {
                statusMessageEl.innerHTML = '<span class="status-error">❌ Erreur : Aucun identifiant de permis fourni.</span>';
                return;
            }

            fetch(apiUrl + '?id=' + permisId)
                .then(response => {
                    if (!response.ok) throw new Error("Erreur réseau");
                    return response.json();
                })
                .then(data => {
                    if (data.success && data.permis) {
                        const permis = data.permis;
                        
                        // Mapping des données
                        const fields = {
                            'statut-demande': permis.statut_demande,
                            'nom': permis.nom,
                            'prenoms': permis.prenom,
                            'lieu-naissance': permis.lieu_naissance,
                            'date-naissance': permis.date_naissance,
                            'genre': permis.genre,
                            'nationalite': permis.nationalite,
                            'num-permis': permis.num_permis,
                            'num-capacite': permis.num_capacite,
                            'categories': permis.categories,
                            'date-creation': permis.date_creation
                        };

                        // Remplissage texte sécurisé
                        for (const [id, value] of Object.entries(fields)) {
                            const el = document.getElementById(id);
                            if(el) el.textContent = value || 'N/A';
                        }

                        // Gestion Photo
                        const imgEl = document.getElementById('photo-permis');
                        if(imgEl) imgEl.src = permis.photo_url || '';

                        // Affichage
                        statusMessageEl.style.display = 'none';
                        permisDataEl.style.display = 'block';

                    } else {
                        statusMessageEl.innerHTML = `<span class="status-error">⚠️ Erreur : ${data.error || 'Dossier introuvable.'}</span>`;
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    statusMessageEl.innerHTML = '<span class="status-error">⚠️ Impossible de contacter le serveur. Vérifiez votre connexion.</span>';
                });
        });
    </script>
</body>
</html>
