<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permicam - Vérification</title>
    
    <style>
        /* ============================
           1. RESET & FOND
           ============================ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9; /* Le fond gris clair/bleuté du site officiel */
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ============================
           2. BANNIÈRE (HEADER)
           ============================ */
        .header-banner {
            width: 100%;
            background-color: #fff;
            border-bottom: 4px solid #ffd700; /* La petite ligne jaune souvent présente */
        }
        .header-banner img {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: cover; /* Recadre l'image proprement */
            display: block;
        }

        /* ============================
           3. LE CADRE PRINCIPAL (La boite blanche)
           ============================ */
        .main-container {
            background-color: white;
            
            /* C'EST ICI QUE SE JOUE LE CENTRAGE */
            width: 90%;            /* Largeur sur mobile */
            max-width: 850px;      /* Largeur max sur PC */
            margin: 30px auto;     /* 30px haut/bas, AUTO gauche/droite (CENTRAGE) */
            
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* Légère ombre */
            border: 1px solid #e1e1e1; /* Fine bordure grise */
            border-radius: 4px;
        }

        /* ============================
           4. TITRES ET EN-TÊTES
           ============================ */
        .panel-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #e1e1e1;
        }
        .panel-header h2 {
            font-size: 1.1rem;
            text-transform: uppercase;
            color: #444;
            font-weight: 700;
        }

        .sub-header {
            padding: 15px 20px;
            background-color: #f8f9fa; /* Fond gris très clair pour le sous-titre */
            border-bottom: 1px solid #e1e1e1;
            font-weight: bold;
            color: #333;
            text-transform: uppercase;
            font-size: 0.95rem;
        }

        /* ============================
           5. LA GRILLE DE DONNÉES (Style Tableau)
           ============================ */
        .data-row {
            display: flex; /* Met le label et la valeur côte à côte */
            border-bottom: 1px solid #e1e1e1; /* Ligne de séparation */
            background-color: white;
        }

        /* Colonne de Gauche (Labels) */
        .col-label {
            width: 40%;
            padding: 12px 20px;
            font-weight: 600;
            color: #333;
            background-color: #fff;
            border-right: 1px solid #f0f0f0; /* Petite ligne verticale optionnelle */
            display: flex;
            align-items: center; /* Centre le texte verticalement */
        }

        /* Colonne de Droite (Valeurs) */
        .col-value {
            width: 60%;
            padding: 12px 20px;
            color: #000;
            font-weight: 600;
        }

        /* Gestion spécifique pour la photo */
        .row-photo .col-value {
            display: flex;
            justify-content: center; /* Centre la photo horizontalement */
            padding: 20px;
        }
        .photo-cadre {
            padding: 4px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            display: inline-block;
        }
        #photo-permis {
            width: 120px;
            height: 150px;
            object-fit: cover;
            display: block;
            background-color: #eee;
        }

        /* ============================
           6. ETATS ET COULEURS
           ============================ */
        .status-text {
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-valid { color: #28a745; } /* Vert */
        .status-error { color: #dc3545; } /* Rouge */
        .status-wait { color: #ffc107; }  /* Jaune */

        /* ============================
           7. CHARGEMENT
           ============================ */
        #loading { padding: 40px; text-align: center; color: #0056b3; font-weight: bold;}
        .hidden { display: none; }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: auto;
            padding: 20px;
            color: #888;
            font-size: 0.8rem;
        }

        /* Responsive Mobile : Si l'écran est petit, on empile */
        @media (max-width: 600px) {
            .data-row { flex-direction: column; }
            .col-label { width: 100%; background-color: #f9f9f9; border-right: none; border-bottom: 1px dashed #eee; padding: 8px 20px;}
            .col-value { width: 100%; padding: 10px 20px;}
        }
    </style>
</head>
<body>

    <div class="header-banner">
        <img src="banniere_header.jpg" alt="Ministère des Transports">
    </div>

    <div class="main-container">
        
        <div class="panel-header">
            <h2>Bienvenue sur le portail d'enrôlement à la demande de permis de conduire et badge</h2>
        </div>

        <div id="loading">Chargement des informations...</div>

        <div id="content" class="hidden">
            
            <div class="sub-header">Demande de Permis de Conduire</div>

            <div class="sub-header" style="background: white; border-bottom: 1px solid #ddd; margin-top:0;">Récapitulatif de la demande</div>

            <div class="data-row">
                <div class="col-label">Etat de la demande</div>
                <div class="col-value">
                    <span id="statut-demande" class="status-text">...</span>
                </div>
            </div>

            <div class="sub-header">Identité du détenteur</div>

            <div class="data-row row-photo">
                <div class="col-label">Photo</div>
                <div class="col-value">
                    <div class="photo-cadre">
                        <img id="photo-permis" src="" alt="Photo">
                    </div>
                </div>
            </div>

            <div class="data-row">
                <div class="col-label">Nom</div>
                <div class="col-value" id="nom"></div>
            </div>

            <div class="data-row">
                <div class="col-label">Prénoms</div>
                <div class="col-value" id="prenoms"></div>
            </div>

            <div class="data-row">
                <div class="col-label">Date et Lieu de naissance</div>
                <div class="col-value">
                    <span id="date-naissance"></span> à <span id="lieu-naissance"></span>
                </div>
            </div>

            <div class="data-row">
                <div class="col-label">Genre</div>
                <div class="col-value" id="genre"></div>
            </div>

            <div class="data-row">
                <div class="col-label">Nationalité</div>
                <div class="col-value" id="nationalite"></div>
            </div>

            <div class="data-row">
                <div class="col-label">Numéro de permis</div>
                <div class="col-value" id="num-permis"></div>
            </div>

             <div class="data-row">
                <div class="col-label">Numéro de capacité</div>
                <div class="col-value" id="num-capacite"></div>
            </div>

            <div class="data-row">
                <div class="col-label">Catégories du permis</div>
                <div class="col-value" id="categories"></div>
            </div>

            <div class="data-row" style="border-bottom: none;">
                <div class="col-label">Date de création</div>
                <div class="col-value" id="date-creation"></div>
            </div>

        </div>
    </div>

    <div class="footer">
        Copyright © 2025 - All rights reserved - MINT - Cameroon
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const apiUrl = "https://www.cartegrisecameroun.com/public/api/getPermisInfo.php";
            const loading = document.getElementById("loading");
            const content = document.getElementById("content");
            
            const params = new URLSearchParams(window.location.search);
            const permisId = params.get('id');

            if (!permisId) {
                loading.innerHTML = '<span style="color:red">Aucun ID fourni.</span>';
                return;
            }

            fetch(apiUrl + '?id=' + permisId)
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.permis) {
                        const p = data.permis;

                        // Remplissage des champs simples
                        const ids = ['nom', 'prenoms', 'lieu-naissance', 'date-naissance', 'genre', 'nationalite', 'num-permis', 'num-capacite', 'categories', 'date-creation'];
                        ids.forEach(key => {
                            const el = document.getElementById(key);
                            if(el) {
                                // On gère le cas des tirets vs underscores
                                const api key = key.replace('-', '_');
                                el.textContent = p[api key] || p[key] || 'N/A';
                            }
                        });

                        document.getElementById('photo-permis').src = p.photo_url || '';
                        
                        // Gestion Statut et Couleur (Vert si valide)
                        const stEl = document.getElementById('statut-demande');
                        const stTxt = (p.statut_demande || 'Inconnu');
                        stEl.textContent = stTxt;
                        
                        if(stTxt.toLowerCase().includes('valid') || stTxt.toLowerCase().includes('traitement')) {
                            stEl.className = 'status-text status-valid'; // Vert
                        } else if(stTxt.toLowerCase().includes('rejet')) {
                            stEl.className = 'status-text status-error'; // Rouge
                        } else {
                            stEl.className = 'status-text status-wait'; // Jaune
                        }

                        loading.style.display = 'none';
                        content.style.display = 'block';
                    } else {
                        loading.innerHTML = '<span style="color:red">Dossier introuvable.</span>';
                    }
                })
                .catch(err => {
                    loading.innerHTML = '<span style="color:red">Erreur de connexion serveur.</span>';
                });
        });
    </script>
</body>
</html>
